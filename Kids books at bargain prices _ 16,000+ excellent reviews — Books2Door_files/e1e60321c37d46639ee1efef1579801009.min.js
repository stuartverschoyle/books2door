function injectScript(url,async,defer){var s=document.createElement('script');s.type='text/javascript';s.async=async;s.defer=defer;s.src=url;var x=document.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}
function convertToUrl(params){return url=Object.keys(params).map(function(k){return k+'='+params[k];}).join('&');}
function makeAjaxCall(url,parseJson,callback){var xhttp=new XMLHttpRequest();if(callback){xhttp.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){if(parseJson){callback(JSON.parse(this.response));}else{callback(this.response);}}};}
xhttp.open("GET",url,true);xhttp.send();}
function formatDate(date){var d=new Date(date),month=''+(d.getMonth()+1),day=''+d.getDate(),year=d.getFullYear();if(month.length<2)month='0'+month;if(day.length<2)day='0'+day;return[year,month,day].join('-');}
injectScript('https://www.googletagmanager.com/gtag/js?id=AW-1002921943',true,false);window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','AW-1002921943');var format='<sku>';function triggerPixelPrevious(params){if(params!==undefined){params['shop_id']='books2door.myshopify.com';var timestamp=Math.floor(Date.now());var s=document.createElement('img');var data=encodeURIComponent(Object.keys(params).map(function(k){return k+'='+params[k];}).join(';'));s.setAttribute("src","//googleads.g.doubleclick.net/pagead/viewthroughconversion/1002921943/?label=1nSACP-uur8BENe_nd4D&guid=ON&script=0&random="+timestamp+"&data="+data);s.setAttribute("height",1);s.setAttribute("width",1);s.setAttribute("style","border-style:none;");document.body.appendChild(s);}}
function triggerPixel(event,params){params['shop_id']='books2door.myshopify.com';params['send_to']=['AW-1002921943'];gtag('event',event,params);}
function getProductInfo(product,params){var productId=format.replace('<product_id>',product.id),variantId=params.variant,variant,price;if(variantId){var variantMap={};var x;for(x of product.variants){variantMap[x.id]=x;}
variant=variantMap[variantId];}
if(variant===undefined&&product.variants.length>0){var ids=[],totalPrice=0,v;for(v of product.variants){ids.push(productId.replace('<variant_id>',v.id).replace('<sku>',v.sku));totalPrice+=parseFloat(v.price);}
return{'id':ids,'price':totalPrice/product.variants.length}}else if(variant!==undefined){return{'id':productId.replace('<variant_id>',variant.id).replace('<sku>',variant.sku),'price':variant.price};}
return{'id':productId,'price':product.price};}
function getProductIdFromItem(item){return format.replace('<product_id>',item.product_id).replace('<sku>',item.sku?item.sku:'').replace('<variant_id>',item.variant_id?item.variant_id:'')}
var bodyClass=document.getElementsByTagName('body')[0].getAttribute('class');var template;if(bodyClass){var templateClass=bodyClass.match(/[\w-]*template[\w-]*/g);if(templateClass){template=templateClass[0].replace('template-','');}}
var pageType=ShopifyAnalytics.meta.page.pageType;if(template=='cart'||location.href.includes('/cart')){makeAjaxCall('/cart.json',true,function(response){var cart=response;var productIds=cart.items.map(function(item){return getProductIdFromItem(item);});triggerPixelPrevious({'ecomm_prodid':productIds,'ecomm_pagetype':'cart','ecomm_totalvalue':cart.total_price/100});});}else if(template=='product'||pageType=='product'||location.href.includes('/products')){makeAjaxCall('/products/'+window.location.pathname.split('/products/')[1]+'.json',true,function(response){var product=response.product;var params={},v;for(x of decodeURIComponent(window.location.search.substring(1)).split('&')){var query=x.split('=');params[query[0]]=query[1];}
var productInfo=getProductInfo(product,params);triggerPixelPrevious({'ecomm_prodid':productInfo.id,'ecomm_pagetype':'product','ecomm_category':product.product_type,'ecomm_totalvalue':productInfo.price});});}else if(template=='collection'||pageType=='collection'||location.href.includes('/collections')){var path=window.location.pathname;triggerPixelPrevious({'ecomm_pagetype':'category','ecomm_category':path.replace('/collections/','')});}else if(template=='index'||pageType=='home'){triggerPixelPrevious({'ecomm_pagetype':'home'});}else if(template=='search'||pageType=='searchresults'||location.href.includes('/search')){triggerPixelPrevious({'ecomm_pagetype':'searchresults'});}else{triggerPixelPrevious({'ecomm_pagetype':'other'});}